<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Financial Wellbeing Dashboard - HoFT</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.7.1/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        :root {
            --hoft-blue: #001E62;
            --hoft-orange: #FF5C39;
            --hoft-light-blue: #345082;
        }
        
        body {
            font-family: Arial, sans-serif;
            background-color: #f8f9fa;
        }
        
        .hoft-blue {
            background-color: var(--hoft-blue);
        }
        
        .hoft-orange {
            background-color: var(--hoft-orange);
        }
        
        .hoft-border {
            border-color: var(--hoft-blue);
        }
        
        .hoft-text {
            color: var(--hoft-blue);
        }
        
        .hoft-btn {
            background-color: var(--hoft-blue);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 0.375rem;
            font-weight: 500;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: background-color 0.2s;
        }
        
        .hoft-btn:hover {
            background-color: #001a4e;
        }
        
        .hoft-btn-orange {
            background-color: var(--hoft-orange);
        }
        
        .hoft-btn-orange:hover {
            background-color: #e04e30;
        }
        
        .card {
            border-radius: 0.5rem;
            overflow: hidden;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }
        
        .card-header {
            background-color: var(--hoft-blue);
            color: white;
            padding: 0.75rem 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .card-body {
            background-color: #f9fafb;
            padding: 1rem;
        }
        
        /* Diagonales Design-Element */
        .diagonal-divider {
            position: relative;
            height: 2rem;
            margin-bottom: 1rem;
            overflow: hidden;
        }
        
        .diagonal-right {
            position: absolute;
            top: 0;
            right: 0;
            width: 50%;
            height: 4rem;
            background-color: white;
            transform: rotate(3deg);
            transform-origin: bottom right;
        }
        
        .diagonal-left {
            position: absolute;
            top: 0;
            left: 0;
            width: 50%;
            height: 4rem;
            background-color: white;
            transform: rotate(-3deg);
            transform-origin: bottom left;
        }

        /* PDF Export Styles */
        #pdfPreview {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        #pdfPreviewContent {
            background-color: white;
            padding: 2rem;
            border-radius: 0.5rem;
            max-width: 800px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .loader {
            border: 5px solid #f3f3f3;
            border-top: 5px solid var(--hoft-blue);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 2s linear infinite;
            margin: 20px auto;
            display: none;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-white">
    <div class="container mx-auto px-4 py-8 max-w-6xl">
        <!-- Header -->
        <header class="flex justify-between items-center mb-6">
            <div class="flex items-center">
                <div class="mr-2 font-bold text-white bg-blue-900 p-2 rounded" style="background-color: var(--hoft-blue);">
                    <span class="block text-xl">HoFT</span>
                </div>
                <div class="text-xs text-blue-900" style="color: var(--hoft-blue);">
                    <span class="block">House of</span>
                    <span class="block">Finance & Tech</span>
                </div>
            </div>
            <div class="text-sm text-gray-500">Berlin, April 2025</div>
        </header>
        
        <h1 class="text-3xl font-bold mb-6 text-center text-gray-800">Financial Wellbeing Dashboard</h1>
        
        <!-- Hauptcontainer -->
        <main>
            <!-- Gesamtscore -->
            <div class="hoft-blue text-white p-6 mb-4 rounded-md flex flex-col items-center">
                <p class="text-lg mb-1">Übergreifende Abdeckung der Bedarfsfelder:</p>
                <p class="text-5xl font-bold" id="gesamtScore">47%</p>
            </div>
            
            <!-- Diagonales Design-Element -->
            <div class="diagonal-divider">
                <div class="diagonal-right"></div>
                <div class="diagonal-left"></div>
            </div>
            
            <!-- Drei Hauptbereiche -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                <!-- Finanzielle Basis -->
                <div class="card">
                    <div class="card-header">
                        <span class="text-sm md:text-base">Finanzielle Basis</span>
                        <span class="text-xl font-bold" id="finanzielleBasisScore">45%</span>
                    </div>
                    <div class="card-body">
                        <h3 class="font-semibold mb-2 text-gray-700">Monatliche Übersicht</h3>
                        <div class="mb-4">
                            <div class="grid grid-cols-2 gap-2">
                                <label class="text-sm text-gray-600">Einkommen (€):</label>
                                <input 
                                    type="number" 
                                    id="einkommen" 
                                    value="3250" 
                                    class="border px-2 py-1 w-full rounded-sm"
                                >
                                
                                <label class="text-sm text-gray-600">Fixkosten (€):</label>
                                <input 
                                    type="number" 
                                    id="fixkosten" 
                                    value="1880" 
                                    class="border px-2 py-1 w-full rounded-sm"
                                >
                                
                                <label class="text-sm text-gray-600">Variable Ausgaben (€):</label>
                                <input 
                                    type="number" 
                                    id="variableAusgaben" 
                                    value="940" 
                                    class="border px-2 py-1 w-full rounded-sm"
                                >
                                
                                <label class="text-sm font-semibold text-gray-700">Überschuss:</label>
                                <span class="font-semibold text-gray-700" id="ueberschuss">430 €</span>
                            </div>
                            
                            <div class="mt-4 text-sm text-gray-600">
                                Sparquote: <span id="sparquote">13</span>% (Empfehlung: 15%)
                            </div>
                        </div>
                        
                        <h3 class="font-semibold mb-2 text-gray-700">Notgroschen</h3>
                        <div class="mb-4">
                            <div class="grid grid-cols-2 gap-2">
                                <label class="text-sm text-gray-600">Notgroschen (€):</label>
                                <input 
                                    type="number" 
                                    id="notgroschen" 
                                    value="1450" 
                                    class="border px-2 py-1 w-full rounded-sm"
                                >
                            </div>
                            <div class="mt-1 text-sm text-gray-600">
                                Empfohlen wären <span id="empfohlenerNotgroschen">8460</span> € (3 Monatsausgaben)
                            </div>
                        </div>
                        
                        <h3 class="font-semibold mb-2 text-gray-700">Schulden</h3>
                        <div class="grid grid-cols-2 gap-2">
                            <label class="text-sm text-gray-600">Konsumentenkredit (€):</label>
                            <input 
                                type="number" 
                                id="konsumentenkredit" 
                                value="1100" 
                                class="border px-2 py-1 w-full rounded-sm"
                            >
                            
                            <label class="text-sm text-gray-600">Dispositionskredit (€):</label>
                            <input 
                                type="number" 
                                id="dispositionskredit" 
                                value="2050" 
                                class="border px-2 py-1 w-full rounded-sm"
                            >
                            
                            <label class="text-sm font-semibold text-gray-700">Total:</label>
                            <span class="font-semibold text-gray-700" id="gesamtSchulden">3150 €</span>
                        </div>
                    </div>
                </div>
                
                <!-- Anlage & Vermögensbasis -->
                <div class="card">
                    <div class="card-header">
                        <span class="text-sm md:text-base">Anlage & Vermögensbasis</span>
                        <span class="text-xl font-bold" id="anlageVermogensScore">55%</span>
                    </div>
                    <div class="card-body">
                        <h3 class="font-semibold mb-2 text-gray-700">Aktueller Vermögensstand</h3>
                        <div class="mb-4">
                            <div class="grid grid-cols-2 gap-2">
                                <label class="text-sm text-gray-600">Tagesgeld (€):</label>
                                <input 
                                    type="number" 
                                    id="tagesgeld" 
                                    value="8000" 
                                    class="border px-2 py-1 w-full rounded-sm"
                                >
                                
                                <label class="text-sm text-gray-600">ETF (€):</label>
                                <input 
                                    type="number" 
                                    id="etf" 
                                    value="12500" 
                                    class="border px-2 py-1 w-full rounded-sm"
                                >
                                
                                <label class="text-sm text-gray-600">Bausparen (€):</label>
                                <input 
                                    type="number" 
                                    id="bausparen" 
                                    value="7300" 
                                    class="border px-2 py-1 w-full rounded-sm"
                                >
                                
                                <label class="text-sm font-semibold text-gray-700">Total:</label>
                                <span class="font-semibold text-gray-700" id="gesamtVermoegen">27800 €</span>
                            </div>
                            
                            <div class="flex justify-center mt-4">
                                <canvas id="vermoegenChart" width="150" height="150"></canvas>
                            </div>
                            
                            <div class="mt-2">
                                <div class="grid grid-cols-2 gap-2">
                                    <label class="text-sm text-gray-600">Vermögensziel (€):</label>
                                    <input 
                                        type="number" 
                                        id="vermogensziel" 
                                        value="100000" 
                                        class="border px-2 py-1 w-full rounded-sm"
                                    >
                                    
                                    <label class="text-sm text-gray-600">Zieljahr:</label>
                                    <input 
                                        type="number" 
                                        id="zieljahr" 
                                        value="2040" 
                                        class="border px-2 py-1 w-full rounded-sm"
                                    >
                                </div>
                                <div class="mt-1 text-sm text-gray-600">
                                    Ziel: <span id="vermogenszielDisplay">100.000</span> € bis <span id="zieljahrDisplay">2040</span> (<span id="vermogensZielFortschritt">28</span>% erreicht)
                                </div>
                            </div>
                        </div>
                        
                        <h3 class="font-semibold mb-2 text-gray-700">Altersvorsorge</h3>
                        <div class="grid grid-cols-2 gap-2">
                            <label class="text-sm text-gray-600">Gesetzliche Rentenansprüche (€):</label>
                            <input 
                                type="number" 
                                id="gesetzlicheRente" 
                                value="1100" 
                                class="border px-2 py-1 w-full rounded-sm"
                            >
                            
                            <label class="text-sm text-gray-600">Betriebliche Altersvorsorge (€):</label>
                            <input 
                                type="number" 
                                id="betrieblicheAltersvorsorge" 
                                value="750" 
                                class="border px-2 py-1 w-full rounded-sm"
                            >
                            
                            <label class="text-sm text-gray-600">Private Vorsorge (€):</label>
                            <input 
                                type="number" 
                                id="privateVorsorge" 
                                value="0" 
                                class="border px-2 py-1 w-full rounded-sm"
                            >
                            
                            <label class="text-sm font-semibold text-gray-700">Erwartete monatliche Rente:</label>
                            <span class="font-semibold text-gray-700" id="monatlicheRente">1850 €</span>
                        </div>
                        <div class="mt-1 text-sm text-gray-600">
                            Deine aktuelle Vorsorge deckt rund <span id="vorsorgedeckung">60</span>% deiner aktuellen Lebenshaltungskosten ab
                        </div>
                    </div>
                </div>
                
                <!-- Risikoabsicherung -->
                <div class="card">
                    <div class="card-header">
                        <span class="text-sm md:text-base">Risikoabsicherung</span>
                        <span class="text-xl font-bold" id="risikoScore">42%</span>
                    </div>
                    <div class="card-body">
                        <h3 class="font-semibold mb-2 text-gray-700">Personenschutz</h3>
                        <div class="mb-4">
                            <div class="flex items-center mb-1">
                                <input 
                                    type="checkbox" 
                                    id="berufsunfaehigkeit" 
                                    checked 
                                    class="mr-2"
                                >
                                <label for="berufsunfaehigkeit" class="text-sm text-gray-600">Berufsunfähigkeitsversicherung</label>
                            </div>
                            <div id="berufsunfaehigkeitDetails" class="pl-6 mb-2">
                                <label class="text-sm text-gray-600">Betrag (€/Monat):</label>
                                <input 
                                    type="number" 
                                    id="berufsunfaehigkeitBetrag" 
                                    value="1200" 
                                    class="border px-2 py-1 w-32 ml-2 rounded-sm"
                                >
                            </div>
                            
                            <div class="flex items-center mb-1">
                                <input 
                                    type="checkbox" 
                                    id="leben" 
                                    class="mr-2"
                                >
                                <label for="leben" class="text-sm text-gray-600">Lebensversicherung</label>
                            </div>
                            
                            <div class="flex items-center mb-1">
                                <input 
                                    type="checkbox" 
                                    id="pflege" 
                                    class="mr-2"
                                >
                                <label for="pflege" class="text-sm text-gray-600">Pflegeversicherung</label>
                            </div>
                            
                            <div class="flex items-center mb-1">
                                <input 
                                    type="checkbox" 
                                    id="unfall" 
                                    class="mr-2"
                                >
                                <label for="unfall" class="text-sm text-gray-600">Unfallversicherung</label>
                            </div>
                            
                            <div class="flex items-center mb-1">
                                <input 
                                    type="checkbox" 
                                    id="ausland" 
                                    class="mr-2"
                                >
                                <label for="ausland" class="text-sm text-gray-600">Auslandsreisekrankenversicherung</label>
                            </div>
                        </div>
                        
                        <h3 class="font-semibold mb-2 text-gray-700">Sachschutz</h3>
                        <div class="mb-4">
                            <div class="flex items-center mb-1">
                                <input 
                                    type="checkbox" 
                                    id="hausrat" 
                                    class="mr-2"
                                >
                                <label for="hausrat" class="text-sm text-gray-600">Hausratversicherung</label>
                            </div>
                            
                            <div class="flex items-center mb-1">
                                <input 
                                    type="checkbox" 
                                    id="haftpflicht" 
                                    checked 
                                    class="mr-2"
                                >
                                <label for="haftpflicht" class="text-sm text-gray-600">Haftpflichtversicherung</label>
                            </div>
                            <div id="haftpflichtDetails" class="pl-6 mb-2">
                                <label class="text-sm text-gray-600">Deckungssumme (Mio. €):</label>
                                <input 
                                    type="number" 
                                    id="haftpflichtDeckung" 
                                    value="10" 
                                    class="border px-2 py-1 w-24 ml-2 rounded-sm"
                                >
                            </div>
                            
                            <div class="flex items-center mb-1">
                                <input 
                                    type="checkbox" 
                                    id="rechtsschutz" 
                                    checked 
                                    class="mr-2"
                                >
                                <label for="rechtsschutz" class="text-sm text-gray-600">Rechtsschutzversicherung</label>
                            </div>
                            <div id="rechtsschutzDetails" class="pl-6 mb-2">
                                <label class="text-sm text-gray-600">Beitrag (€/Monat):</label>
                                <input 
                                    type="number" 
                                    id="rechtsschutzBeitrag" 
                                    value="19.90" 
                                    step="0.01"
                                    class="border px-2 py-1 w-24 ml-2 rounded-sm"
                                >
                            </div>
                            
                            <div class="flex items-center mb-1">
                                <input 
                                    type="checkbox" 
                                    id="kfz" 
                                    checked 
                                    class="mr-2"
                                >
                                <label for="kfz" class="text-sm text-gray-600">Kfz-Versicherung</label>
                            </div>
                            
                            <div class="flex items-center mb-1">
                                <input 
                                    type="checkbox" 
                                    id="elektronik" 
                                    class="mr-2"
                                >
                                <label for="elektronik" class="text-sm text-gray-600">Elektronikversicherung</label>
                            </div>
                        </div>
                        
                        <h3 class="font-semibold mb-2 text-gray-700">Notfallordner</h3>
                        <div>
                            <div class="flex items-center mb-1">
                                <input 
                                    type="checkbox" 
                                    id="patientenverfuegung" 
                                    checked 
                                    class="mr-2"
                                >
                                <label for="patientenverfuegung" class="text-sm text-gray-600">Patientenverfügung</label>
                            </div>
                            
                            <div class="flex items-center mb-1">
                                <input 
                                    type="checkbox" 
                                    id="vorsorgevollmacht" 
                                    checked 
                                    class="mr-2"
                                >
                                <label for="vorsorgevollmacht" class="text-sm text-gray-600">Vorsorgevollmacht</label>
                            </div>
                            
                            <div class="flex items-center mb-1">
                                <input 
                                    type="checkbox" 
                                    id="betreuungsverfuegung" 
                                    checked 
                                    class="mr-2"
                                >
                                <label for="betreuungsverfuegung" class="text-sm text-gray-600">Betreuungsverfügung</label>
                            </div>
                            
                            <div class="flex items-center mb-1">
                                <input 
                                    type="checkbox" 
                                    id="testament" 
                                    class="mr-2"
                                >
                                <label for="testament" class="text-sm text-gray-600">Testament</label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Empfehlungsbereich -->
            <div class="bg-white p-6 rounded-md shadow-md border border-gray-100">
                <div class="flex items-center mb-4">
                    <div class="w-8 h-8 rounded-full flex items-center justify-center mr-3 hoft-orange">
                        <span class="text-white font-bold">€</span>
                    </div>
                    <h2 class="text-xl font-semibold text-gray-800">Empfehlungen für deine finanzielle Zukunft</h2>
                </div>
                
                <div id="empfehlungen" class="space-y-3">
                    <!-- Empfehlungen werden dynamisch eingefügt -->
                </div>

                <div class="mt-6 flex justify-center">
                    <button id="createPdfBtn" class="py-3 px-8 rounded-md text-white font-semibold transition hoft-btn-orange">
                        Empfehlungen als PDF herunterladen
                    </button>
                    <div class="loader" id="pdfLoader"></div>
                </div>
            </div>
            
        </main>
        
        <!-- Footer -->
        <footer class="mt-8 pt-6 border-t border-gray-200 flex justify-between items-center">
            <div class="text-sm text-gray-500">
                Financial Wellbeing Hub | April 2025
            </div>
            <div class="flex items-center">
                <div class="mr-2 font-bold text-white bg-blue-900 p-2 rounded" style="background-color: var(--hoft-blue);">
                    <span class="block text-xl">HoFT</span>
                </div>
                <div class="text-xs text-blue-900" style="color: var(--hoft-blue);">
                    <span class="block">House of</span>
                    <span class="block">Finance & Tech</span>
                </div>
            </div>
        </footer>
    </div>

    <!-- PDF Preview Modal -->
    <div id="pdfPreview" class="pdf-preview">
        <div id="pdfPreviewContent">
            <h2 class="text-xl font-bold mb-4">Deine finanziellen Empfehlungen</h2>
            <div id="pdfEmpfehlungen" class="mb-4"></div>
            
            <div class="p-4 mb-4 bg-gray-100 border-l-4 border-gray-400 rounded">
                <p class="text-sm font-bold">Disclaimer:</p>
                <p class="text-sm">Diese Empfehlungen basieren auf den von dir eingegebenen Daten und stellen keine professionelle Finanzberatung dar. Für individuelle Finanzberatung empfehlen wir dir, einen qualifizierten Finanzberater zu konsultieren. Die hier dargestellten Informationen dienen ausschließlich zu Informationszwecken.</p>
            </div>
            
            <div class="flex space-x-4 justify-end">
                <button id="cancelPdfBtn" class="px-4 py-2 bg-gray-200 rounded hover:bg-gray-300">Abbrechen</button>
                <button id="downloadPdfBtn" class="px-4 py-2 text-white rounded hoft-orange">PDF herunterladen</button>
            </div>
        </div>
    </div>

    <script>
        // jsPDF im globalen Kontext verfügbar machen
        const { jsPDF } = window.jspdf;
        
        // Alle Input-Elemente
        const inputs = document.querySelectorAll('input');
        
        // Alle Checkboxen mit Detailsbereich
        const checkboxesWithDetails = {
            'berufsunfaehigkeit': 'berufsunfaehigkeitDetails',
            'haftpflicht': 'haftpflichtDetails',
            'rechtsschutz': 'rechtsschutzDetails'
        };
        
        // Vermögen Chart initialisieren
        let vermoegenChart;
        
        // Initial nach dem Laden der Seite
        document.addEventListener('DOMContentLoaded', function() {
            // Checkboxen Funktionalität
            Object.keys(checkboxesWithDetails).forEach(checkboxId => {
                const checkbox = document.getElementById(checkboxId);
                const detailsId = checkboxesWithDetails[checkboxId];
                
                if (checkbox && document.getElementById(detailsId)) {
                    checkbox.addEventListener('change', function() {
                        document.getElementById(detailsId).style.display = this.checked ? 'block' : 'none';
                        updateAllCalculations();
                    });
                    
                    // Initial setzen
                    document.getElementById(detailsId).style.display = checkbox.checked ? 'block' : 'none';
                }
            });
            
            // Alle Inputs mit Event-Listener versehen
            inputs.forEach(input => {
                // Bei jeder Änderung sofort neu berechnen
                if (input.type === 'checkbox') {
                    input.addEventListener('change', updateAllCalculations);
                } else {
                    input.addEventListener('input', updateAllCalculations);
                }
            });
            
            // Chart initialisieren
            initChart();
            
            // PDF-Export Button
            document.getElementById('createPdfBtn').addEventListener('click', showPdfPreview);
            
            // PDF Preview Modal Buttons
            document.getElementById('cancelPdfBtn').addEventListener('click', () => {
                document.getElementById('pdfPreview').style.display = 'none';
            });
            
            document.getElementById('downloadPdfBtn').addEventListener('click', generatePDF);
            
            // Initial berechnen
            updateAllCalculations();
        });
        
        // Chart initialisieren
        function initChart() {
            const ctx = document.getElementById('vermoegenChart').getContext('2d');
            vermoegenChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Tagesgeld', 'ETF', 'Bausparen'],
                    datasets: [{
                        data: [8000, 12500, 7300],
                        backgroundColor: [
                            '#001E62', // HoFT Blue
                            '#FF5C39', // HoFT Orange
                            '#345082'  // Light Blue
                        ],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    cutout: '60%',
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });
        }
        
        // Aktualisieren des Vermögen-Charts
        function updateVermoegenChart() {
            const tagesgeld = parseFloat(document.getElementById('tagesgeld').value) || 0;
            const etf = parseFloat(document.getElementById('etf').value) || 0;
            const bausparen = parseFloat(document.getElementById('bausparen').value) || 0;
            
            vermoegenChart.data.datasets[0].data = [tagesgeld, etf, bausparen];
            vermoegenChart.update();
        }
        
        // Alle Berechnungen aktualisieren
        function updateAllCalculations() {
            // Finanzielle Basis
            updateFinanzielleBasis();
            
            // Anlage & Vermögensbasis
            updateAnlageVermoegen();
            
            // Risikoabsicherung
            updateRisikoabsicherung();
            
            // Gesamtscore
            updateGesamtscore();
            
            // Empfehlungen
            updateEmpfehlungen();
            
            // Chart aktualisieren
            updateVermoegenChart();
        }
        
        // Finanzielle Basis Berechnungen
        function updateFinanzielleBasis() {
            // Werte aus Eingabefeldern holen
            const einkommen = parseFloat(document.getElementById('einkommen').value) || 0;
            const fixkosten = parseFloat(document.getElementById('fixkosten').value) || 0;
            const variableAusgaben = parseFloat(document.getElementById('variableAusgaben').value) || 0;
            const notgroschen = parseFloat(document.getElementById('notgroschen').value) || 0;
            const konsumentenkredit = parseFloat(document.getElementById('konsumentenkredit').value) || 0;
            const dispositionskredit = parseFloat(document.getElementById('dispositionskredit').value) || 0;
            
            // Berechnungen
            const ueberschuss = einkommen - fixkosten - variableAusgaben;
            const sparquote = Math.round((ueberschuss / einkommen) * 100);
            const gesamtSchulden = konsumentenkredit + dispositionskredit;
            const empfohlenerNotgroschen = Math.round((fixkosten + variableAusgaben) * 3);
            
            // Score berechnen
            let score = 0;
            
            // Überschuss vorhanden
            if (ueberschuss > 0) score += 10;
            
            // Notgroschen ausreichend (3 Monatsausgaben)
            const monatsausgaben = fixkosten + variableAusgaben;
            const notgroschenZiel = monatsausgaben * 3;
            const notgroschenRatio = notgroschen / notgroschenZiel;
            score += Math.min(Math.round(notgroschenRatio * 15), 15);
            
            // Sparquote
            if (sparquote >= 15) score += 10;
            else score += Math.round((sparquote / 15) * 10);
            
            // Schulden
            const monatseinkommenRatio = gesamtSchulden / einkommen;
            if (monatseinkommenRatio <= 1) score += 10;
            else if (monatseinkommenRatio <= 3) score += 5;
            
            // Werte in DOM aktualisieren
            document.getElementById('ueberschuss').textContent = ueberschuss + ' €';
            document.getElementById('sparquote').textContent = sparquote;
            document.getElementById('empfohlenerNotgroschen').textContent = empfohlenerNotgroschen;
            document.getElementById('gesamtSchulden').textContent = gesamtSchulden + ' €';
            document.getElementById('finanzielleBasisScore').textContent = score + '%';
            
            return score;
        }
        
        // Anlage & Vermögensbasis Berechnungen
        function updateAnlageVermoegen() {
            // Werte aus Eingabefeldern holen
            const tagesgeld = parseFloat(document.getElementById('tagesgeld').value) || 0;
            const etf = parseFloat(document.getElementById('etf').value) || 0;
            const bausparen = parseFloat(document.getElementById('bausparen').value) || 0;
            const vermogensziel = parseFloat(document.getElementById('vermogensziel').value) || 0;
            const zieljahr = parseFloat(document.getElementById('zieljahr').value) || 0;
            const gesetzlicheRente = parseFloat(document.getElementById('gesetzlicheRente').value) || 0;
            const betrieblicheAltersvorsorge = parseFloat(document.getElementById('betrieblicheAltersvorsorge').value) || 0;
            const privateVorsorge = parseFloat(document.getElementById('privateVorsorge').value) || 0;
            
            // Berechnungen
            const gesamtVermoegen = tagesgeld + etf + bausparen;
            const vermogensZielFortschritt = Math.round((gesamtVermoegen / vermogensziel) * 100);
            const monatlicheRente = gesetzlicheRente + betrieblicheAltersvorsorge + privateVorsorge;
            
            // Vorsorgedeckung berechnen
            const fixkosten = parseFloat(document.getElementById('fixkosten').value) || 0;
            const variableAusgaben = parseFloat(document.getElementById('variableAusgaben').value) || 0;
            const monatlicheAusgaben = fixkosten + variableAusgaben;
            const vorsorgedeckung = Math.round((monatlicheRente / monatlicheAusgaben) * 100);
            
            // Score berechnen
            let score = 0;
            
            // Diversifikation des Vermögens
            const hasTagesgeld = tagesgeld > 0;
            const hasETF = etf > 0;
            const hasBausparen = bausparen > 0;
            
            if (hasTagesgeld) score += 5;
            if (hasETF) score += 10;
            if (hasBausparen) score += 5;
            
            // Fortschritt zum Vermögensziel
            score += Math.min(Math.round(vermogensZielFortschritt / 5), 15);
            
            // Altersvorsorge
            const hasGesetzlicheRente = gesetzlicheRente > 0;
            const hasBetrieblicheVorsorge = betrieblicheAltersvorsorge > 0;
            const hasPrivateVorsorge = privateVorsorge > 0;
            
            if (hasGesetzlicheRente) score += 5;
            if (hasBetrieblicheVorsorge) score += 10;
            if (hasPrivateVorsorge) score += 5;
            
            // Werte in DOM aktualisieren
            document.getElementById('gesamtVermoegen').textContent = gesamtVermoegen + ' €';
            document.getElementById('vermogenszielDisplay').textContent = vermogensziel.toLocaleString();
            document.getElementById('zieljahrDisplay').textContent = zieljahr;
            document.getElementById('vermogensZielFortschritt').textContent = vermogensZielFortschritt;
            document.getElementById('monatlicheRente').textContent = monatlicheRente + ' €';
            document.getElementById('vorsorgedeckung').textContent = vorsorgedeckung;
            document.getElementById('anlageVermogensScore').textContent = score + '%';
            
            return score;
        }
        
        // Risikoabsicherung Berechnungen
        function updateRisikoabsicherung() {
            // Werte aus Checkboxen holen
            const berufsunfaehigkeit = document.getElementById('berufsunfaehigkeit').checked;
            const leben = document.getElementById('leben').checked;
            const pflege = document.getElementById('pflege').checked;
            const unfall = document.getElementById('unfall').checked;
            const ausland = document.getElementById('ausland').checked;
            const hausrat = document.getElementById('hausrat').checked;
            const haftpflicht = document.getElementById('haftpflicht').checked;
            const rechtsschutz = document.getElementById('rechtsschutz').checked;
            const kfz = document.getElementById('kfz').checked;
            const elektronik = document.getElementById('elektronik').checked;
            const patientenverfuegung = document.getElementById('patientenverfuegung').checked;
            const vorsorgevollmacht = document.getElementById('vorsorgevollmacht').checked;
            const betreuungsverfuegung = document.getElementById('betreuungsverfuegung').checked;
            const testament = document.getElementById('testament').checked;
            
            // Score berechnen
            let score = 0;
            
            // Personenschutz
            if (berufsunfaehigkeit) score += 10;
            if (leben) score += 5;
            if (pflege) score += 5;
            if (unfall) score += 3;
            if (ausland) score += 2;
            
            // Sachschutz
            if (hausrat) score += 5;
            if (haftpflicht) score += 10;
            if (rechtsschutz) score += 5;
            if (kfz) score += 3;
            if (elektronik) score += 2;
            
            // Notfallordner
            if (patientenverfuegung) score += 2.5;
            if (vorsorgevollmacht) score += 2.5;
            if (betreuungsverfuegung) score += 2.5;
            if (testament) score += 2.5;
            
            // Werte in DOM aktualisieren
            document.getElementById('risikoScore').textContent = score + '%';
            
            return score;
        }
        
        // Gesamtscore berechnen
        function updateGesamtscore() {
            const finanzielleBasisScore = parseInt(document.getElementById('finanzielleBasisScore').textContent) || 0;
            const anlageVermogensScore = parseInt(document.getElementById('anlageVermogensScore').textContent) || 0;
            const risikoScore = parseInt(document.getElementById('risikoScore').textContent) || 0;
            
            const gesamtScore = Math.round((finanzielleBasisScore + anlageVermogensScore + risikoScore) / 3);
            
            document.getElementById('gesamtScore').textContent = gesamtScore + '%';
            
            return gesamtScore;
        }
        
        // Empfehlungen aktualisieren
        function updateEmpfehlungen() {
            const empfehlungenContainer = document.getElementById('empfehlungen');
            empfehlungenContainer.innerHTML = ''; // Zurücksetzen
            
            const empfehlungen = [];
            
            // Finanzielle Basis Empfehlungen
            const finanzielleBasisScore = parseInt(document.getElementById('finanzielleBasisScore').textContent) || 0;
            const notgroschen = parseFloat(document.getElementById('notgroschen').value) || 0;
            const fixkosten = parseFloat(document.getElementById('fixkosten').value) || 0;
            const variableAusgaben = parseFloat(document.getElementById('variableAusgaben').value) || 0;
            const sparquote = parseInt(document.getElementById('sparquote').textContent) || 0;
            const dispositionskredit = parseFloat(document.getElementById('dispositionskredit').value) || 0;
            
            if (finanzielleBasisScore < 50) {
                empfehlungen.push({
                    text: '<span class="font-semibold text-gray-700">Finanzielle Basis stärken:</span> Dein Score in diesem Bereich ist niedrig. Versuche, deinen Notgroschen aufzubauen und Schulden zu reduzieren.'
                });
            }
            
            if (notgroschen < (fixkosten + variableAusgaben) * 3) {
                empfehlungen.push({
                    text: `<span class="font-semibold text-gray-700">Notgroschen erhöhen:</span> Es wird empfohlen, einen Notgroschen in Höhe von 3 Monatsausgaben (${Math.round((fixkosten + variableAusgaben) * 3)} €) anzusparen.`
                });
            }
            
            if (sparquote < 15) {
                empfehlungen.push({
                    text: `<span class="font-semibold text-gray-700">Sparquote verbessern:</span> Deine aktuelle Sparquote von ${sparquote}% liegt unter der Empfehlung von 15%. Versuche, deine Ausgaben zu optimieren.`
                });
            }
            
            if (dispositionskredit > 0) {
                empfehlungen.push({
                    text: '<span class="font-semibold text-gray-700">Dispositionskredit abbauen:</span> Du zahlst wahrscheinlich hohe Zinsen für deinen Dispokredit. Versuche, diesen schnellstmöglich zurückzuzahlen.'
                });
            }
            
            // Anlage & Vermögensbasis Empfehlungen
            const anlageVermogensScore = parseInt(document.getElementById('anlageVermogensScore').textContent) || 0;
            const privateVorsorge = parseFloat(document.getElementById('privateVorsorge').value) || 0;
            
            if (anlageVermogensScore < 50) {
                empfehlungen.push({
                    text: '<span class="font-semibold text-gray-700">Vermögensaufbau optimieren:</span> Dein Score in diesem Bereich lässt Raum für Verbesserung. Überlege, deine Anlagestrategie zu diversifizieren.'
                });
            }
            
            if (privateVorsorge <= 0) {
                empfehlungen.push({
                    text: '<span class="font-semibold text-gray-700">Private Altersvorsorge einrichten:</span> Du hast noch keine private Altersvorsorge. Dies kann deine finanzielle Sicherheit im Alter verbessern.'
                });
            }
            
            // Risikoabsicherung Empfehlungen
            const risikoScore = parseInt(document.getElementById('risikoScore').textContent) || 0;
            const hausrat = document.getElementById('hausrat').checked;
            const leben = document.getElementById('leben').checked;
            
            if (risikoScore < 50) {
                empfehlungen.push({
                    text: '<span class="font-semibold text-gray-700">Absicherung verbessern:</span> Dein Risikoabsicherungsscore deutet auf Lücken in deiner Versicherungssituation hin.'
                });
            }
            
            if (!hausrat) {
                empfehlungen.push({
                    text: '<span class="font-semibold text-gray-700">Hausratversicherung prüfen:</span> Eine Hausratversicherung schützt deinen Hausrat gegen Schäden wie Feuer, Wasserschäden oder Einbruch.'
                });
            }
            
            if (!leben) {
                empfehlungen.push({
                    text: '<span class="font-semibold text-gray-700">Lebensversicherung erwägen:</span> Eine Lebensversicherung kann deine Familie finanziell absichern.'
                });
            }
            
            // Positive Empfehlung bei hohem Gesamtscore
            const gesamtScore = parseInt(document.getElementById('gesamtScore').textContent) || 0;
            
            if (gesamtScore >= 70) {
                empfehlungen.push({
                    text: '<span class="font-semibold text-gray-700">Gut gemacht!</span> Du hast bereits eine solide finanzielle Basis aufgebaut. Bleib dran und optimiere weiter!',
                    positive: true
                });
            }
            
            // Empfehlungen zum DOM hinzufügen
            empfehlungen.forEach(empfehlung => {
                const div = document.createElement('div');
                div.className = empfehlung.positive 
                    ? 'p-3 bg-green-50 border-l-4 border-green-400 rounded-r-md'
                    : 'p-3 bg-blue-50 border-l-4 hoft-border rounded-r-md';
                div.innerHTML = empfehlung.text;
                empfehlungenContainer.appendChild(div);
            });
            
            return empfehlungen;
        }
        
        // PDF Preview anzeigen
        function showPdfPreview() {
            const pdfPreview = document.getElementById('pdfPreview');
            const pdfEmpfehlungen = document.getElementById('pdfEmpfehlungen');
            
            // Empfehlungen für das PDF vorbereiten
            pdfEmpfehlungen.innerHTML = '';
            
            // Finanzdaten für das PDF zusammenstellen
            const finanzielleBasisScore = document.getElementById('finanzielleBasisScore').textContent;
            const anlageVermogensScore = document.getElementById('anlageVermogensScore').textContent;
            const risikoScore = document.getElementById('risikoScore').textContent;
            const gesamtScore = document.getElementById('gesamtScore').textContent;
            
            // Finanzübersicht hinzufügen
            const finanzUebersicht = document.createElement('div');
            finanzUebersicht.className = 'mb-6';
            finanzUebersicht.innerHTML = `
                <h3 class="text-lg font-semibold mb-2">Deine finanzielle Übersicht</h3>
                <div class="grid grid-cols-2 gap-2 mb-4">
                    <div class="font-semibold">Übergreifende Abdeckung:</div>
                    <div>${gesamtScore}</div>
                    <div class="font-semibold">Finanzielle Basis:</div>
                    <div>${finanzielleBasisScore}</div>
                    <div class="font-semibold">Anlage & Vermögensbasis:</div>
                    <div>${anlageVermogensScore}</div>
                    <div class="font-semibold">Risikoabsicherung:</div>
                    <div>${risikoScore}</div>
                </div>
            `;
            pdfEmpfehlungen.appendChild(finanzUebersicht);
            
            // Empfehlungen hinzufügen
            const empfehlungenTitel = document.createElement('h3');
            empfehlungenTitel.className = 'text-lg font-semibold mb-2';
            empfehlungenTitel.textContent = 'Deine persönlichen Empfehlungen';
            pdfEmpfehlungen.appendChild(empfehlungenTitel);
            
            // Aktuelle Empfehlungen holen
            const empfehlungen = Array.from(document.getElementById('empfehlungen').children);
            
            if (empfehlungen.length === 0) {
                const noEmpfehlungen = document.createElement('p');
                noEmpfehlungen.textContent = 'Keine spezifischen Empfehlungen gefunden. Deine finanzielle Situation ist solide!';
                pdfEmpfehlungen.appendChild(noEmpfehlungen);
            } else {
                empfehlungen.forEach((empfehlung, index) => {
                    const empfehlungClone = empfehlung.cloneNode(true);
                    pdfEmpfehlungen.appendChild(empfehlungClone);
                });
            }
            
            // Datum hinzufügen
            const datum = document.createElement('p');
            datum.className = 'text-sm text-gray-500 mt-4';
            const heute = new Date();
            datum.textContent = `Erstellt am: ${heute.toLocaleDateString('de-DE')}`;
            pdfEmpfehlungen.appendChild(datum);
            
            // Modal anzeigen
            pdfPreview.style.display = 'flex';
        }
        
        // PDF generieren
        function generatePDF() {
            const pdfLoader = document.getElementById('pdfLoader');
            pdfLoader.style.display = 'block';
            
            // PDF Inhalt vorbereiten
            const pdfContent = document.getElementById('pdfPreviewContent');
            
            // PDF erstellen mit jsPDF
            setTimeout(() => {
                const pdf = new jsPDF('p', 'pt', 'a4');
                
                html2canvas(pdfContent, {
                    scale: 2
                }).then(canvas => {
                    const imgData = canvas.toDataURL('image/png');
                    const imgWidth = 595.28; // A4 width in pts
                    const pageHeight = 841.89; // A4 height in pts
                    const imgHeight = canvas.height * imgWidth / canvas.width;
                    let heightLeft = imgHeight;
                    let position = 0;
                    
                    pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
                    heightLeft -= pageHeight;
                    
                    // Bei mehrseitigen PDFs
                    while (heightLeft >= 0) {
                        position = heightLeft - imgHeight;
                        pdf.addPage();
                        pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
                        heightLeft -= pageHeight;
                    }
                    
                    // PDF herunterladen
                    pdf.save('Finanzielle_Empfehlungen_HoFT.pdf');
                    
                    // Modal schließen und Loader ausblenden
                    document.getElementById('pdfPreview').style.display = 'none';
                    pdfLoader.style.display = 'none';
                });
            }, 500);
        }
    </script>
</body>
</html>
